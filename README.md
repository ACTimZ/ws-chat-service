# Чат в реальном времени

## Описание

Этот сервис реализует многопользовательский чат в реальном времени на базе WebSocket. Пользователь может:

- подключиться к одной из существующих комнат;
- отправлять сообщения и получать их от других пользователей, находящихся в этой же комнате;
- видеть через логи в терминале: кто заходит и выходит из комнаты;

Особенность: Для аутентификации используется JWT-токен, который передаётся при подключении

## Стек технологий

- Язык/платформа: Node.js (JavaScript)
- WebSocket-библиотека: ws
- Аутентификация: JWT (jsonwebtoken)
- Генерация уникальных идентификаторов: uuid

## Установка и запуск

1. Склонируйте репозиторий и перейдите в папку проекта:
```bash
git clone https://github.com/ACTimZ/ws-chat-service.git
cd ws-chat-service
```

2. Установите зависимости:
```bash
npm install ws jsonwebtoken uuid readline
```

3. Запустите сервер:
```bash
node ws-service/server.js
```

- после запуска сервера он станет доступным по адресу `ws://localhost:1515`. Это Вы сможете понять по соответствующим логам в терминале:
```
WebSocketServer запущен по адресу - ws://localhost:1515
```

4. Для запуска клиента в отдельном терминале пропишите следующее:
```bash
node ws-service/client.js
```

5. (Необязательный) Для генерации тестового JWT-токена для его отдельного тестирования в стороннем ПО (Postman и пр.) пропишите следующее:
```bash
node ws-service/generating_token_for_testing.js
```

## Пример JSON-сообщений и ожидаемые ответы сервера

### 1. Вход пользователя в комнату (join)

**Запрос:**
```json
{
  "type": "join",
  "username": "Elon",
  "room": "rooma1"
}
```

**Ответ другим участникам комнаты:**
```json
{
  "type": "system",
  "message": "Пользователь Elon вошёл в комнату \"rooma1\""
}
```

---

### 2. Отправка сообщения (message)

**Запрос:**
```json
{
  "type": "message",
  "username": "Elon",
  "room": "rooma1",
  "message": "It's Elon Mask!"
}
```

**Ответ всем участникам комнаты:**
```json
{
  "type": "message",
  "username": "Elon",
  "message": "It's Elon Mask!"
}
```

---

### 3. Выход из комнаты (leave)

**Запрос:**
```json
{
  "type": "leave",
  "username": "Donald",
  "room": "rooma1"
}
```

**Ответ другим участникам комнаты:**
```json
{
  "type": "system",
  "message": "Пользователь Donald покинул комнату"
}
```

---

### 4. Ошибка при наборе неверного события

- Например, если пользователь не укажет явный формат его "действия" (события), то есть напишет одно из трех значений некорректно или совсем другое (их типы: `join`, `leave`, `message`).

**Ответ сервера:**
```json
{
  "type": "error",
  "message": "Ошибка валидации: Вы не указали поле \"type\", которое должно быть со значением \"join\", \"leave\" или \"message\""
}
```

## Механизм аутентификации

- Для подключения к серверу требуется JWT-токен;
- Данный токен передаётся как query-параметр при установке WebSocket-соединения в виде ключа "token" и значения "`выданный-JWT-токен`":
```
ws://localhost:1515?token=<выданный-JWT-токен>
```
- В токене обязательно должно присутствовать поле `username`;
- Пример генерации токена:
```js
let jwt = require("jsonwebtoken");
let jwt_token = jwt.sign(
  {
    username: "Person_1",
  },
  "secret_key",
  {
    expiresIn: "24h",
  }
);
```
- Если токен отсутствует или будет некорректен, то соединение будет закрыто с логированием сообщения в терминале.

---

## Примерная структура проекта

```
ws-chat-service/
├── node_modules/
├── ws-service/
|   ├── client.js                           # Пример клиента в терминале
|   ├── server.js                           # WebSocket сервер (wss)
|   └── generating_token_for_testing.js     # Скрипт для тестирования
├── package-lock.json
├── package.json
└── README.md
```

---

## Примечания

- Сервер автоматически удаляет неактивные соединения (пинг и понг);
- Все сообщения между клиентом и сервером передаются в формате JSON;
- Тестирование сервиса можно также проводить в ПО "Postman", выбрав "WebSocket" в качестве типа соединения и указав адрес сервера. И отправлять тем самым сообщения в формате JSON.